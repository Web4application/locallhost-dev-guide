
<!-- Dynamic User Preferences Panel -->
<div id="user-preferences" style="position: fixed; bottom: 20px; right: 20px; 
     background: #222; color: #fff; padding: 15px; border-radius: 8px; z-index: 1000;">
  <h4 style="margin-top:0;">UI Settings</h4>
  
  <label>
    Theme:
    <select id="theme-select">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>
  </label>
  <br/><br/>
  
  <label>
    Auto-refresh (seconds):
    <input type="number" id="auto-refresh" min="5" max="120" step="5" value="15"/>
  </label>
  <br/><br/>
  
  <label>
    Show Full Log:
    <input type="checkbox" id="show-full-log"/>
  </label>
</div>

<script>
// --- Cookie helpers ---
function setCookie(name, value, days=365) {
  const date = new Date();
  date.setTime(date.getTime() + (days*24*60*60*1000));
  document.cookie = name + "=" + encodeURIComponent(value) + "; expires=" + date.toUTCString() + "; path=/";
}
function getCookie(name) {
  const ca = document.cookie.split(';');
  for(let i=0;i<ca.length;i++){
    let c = ca[i].trim();
    if(c.indexOf(name+'=')==0) return decodeURIComponent(c.substring(name.length+1));
  }
  return null;
}

// --- Apply UI settings dynamically ---
function applyPreferences() {
  const theme = getCookie("theme") || "dark";
  document.body.dataset.theme = theme;   // Assume CSS handles [data-theme="dark"] / "light"

  const autoRefresh = parseInt(getCookie("autoRefresh") || "15");
  if(window.autoRefreshInterval) clearInterval(window.autoRefreshInterval);
  window.autoRefreshInterval = setInterval(() => location.reload(), autoRefresh * 1000);

  const showFullLog = getCookie("showFullLog") === "true";
  const consoles = document.querySelectorAll(".console"); // Adjust selector for your Buildbot logs
  consoles.forEach(c => {
    c.style.display = showFullLog ? "block" : "none";
  });
}

// --- Initialize controls ---
document.addEventListener("DOMContentLoaded", function() {
  const theme = getCookie("theme") || "dark";
  document.getElementById("theme-select").value = theme;

  const autoRefresh = getCookie("autoRefresh") || "15";
  document.getElementById("auto-refresh").value = autoRefresh;

  const showFullLog = getCookie("showFullLog") === "true";
  document.getElementById("show-full-log").checked = showFullLog;

  applyPreferences();
});

// --- Control event listeners ---
document.getElementById("theme-select").addEventListener("change", e => {
  setCookie("theme", e.target.value);
  applyPreferences();
});

document.getElementById("auto-refresh").addEventListener("change", e => {
  setCookie("autoRefresh", e.target.value);
  applyPreferences();
});

document.getElementById("show-full-log").addEventListener("change", e => {
  setCookie("showFullLog", e.target.checked);
  applyPreferences();
});
</script>
